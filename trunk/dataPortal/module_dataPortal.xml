<?xml version="1.0" encoding="UTF-8"?>
<!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  ~ Software License, Version 1.0 Copyright 2009 SRA International, Inc.
  ~ Copyright Notice.  The software subject to this notice and license includes both human
  ~ readable source code form and machine readable, binary, object code form (the "caBIG
  ~ Software").
  ~
  ~ Please refer to the complete License text for full details at the root of the project.
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->

<project name="module_dataPortal" default="module.dataPortal.prepareDeploy">

    <!--
        HOW TO RUN THIS FROM THE COMMAND LINE
		  * In the build.xml file, set the property tcgaproto.deploy to the deploy directory for your app server
        * After the war file is built, it will be copied to the directory specified in tcgaproto.deplo

        My local example (on a Mac):
        ant -buildfile build.xml module.dataPortal.preparedeploy
    -->


    <!-- Setup the base of your module's directory, since we run from inside the Common dir,
    we need to know where the base is, best way to find out is based on the module's xml build file (module_uuid.xml) -->
    <dirname property="module.dataPortal.basedir" file="${ant.file.module_dataPortal}"/>

    <!-- make the directories you need for building and preparing the distribution.
        It's best to include all of them under one dir for easier deployment -->
    <mkdir dir="${tcga.distro}/tcga"/>

    <!-- setup the properties for those directories so we can find them in code.  Don't use IDEA defaults, they don't
        work well. -->
    <property name="dataPortal.distro.dir" value="${tcga.distro}/tcga"/>

    <patternset id="excluded.from.module.dataPortal">
        <patternset refid="ignored.files"/>
    </patternset>

    <patternset id="excluded.from.compilation.dataPortal">
        <patternset refid="excluded.from.module.dataPortal"/>
    </patternset>

    <!-- main target to build the exploded directory and then turn it into a war file -->
    <target name="j2ee.build.dataPortal" description="Build configured Java EE directories and archives for facet &apos;dataPortal&apos;">
        <antcall target="j2ee.build.exploded.dataPortal">
            <param name="j2ee.dir.exploded" value="${dataPortal.distro.dir}"/>
        </antcall>
    </target>

    <!-- Call the target to build exploded directory for facet 'dataPortal'.
Path to the exploded directory is specified by parameter 'j2ee.dir.exploded' -->
    <target name="j2ee.build.exploded.dataPortal" description="Build exploded directory for facet &apos;dataPortal&apos;">
        <!-- copy everything we have created/copied locally in web -->
        <copy todir="${dataPortal.distro.dir}/war/" overwrite="true">
            <fileset dir="${module.dataPortal.basedir}/web/"/>
        </copy>

        <!-- delete what won't get correctly overwritten because it is outside the war on the tiers -->
        <delete file="${dataPortal.distro.dir}/war/WEB-INF/classes/dataPortalApp.properties"/>
    </target>

    <!-- Call the target to build war archive for facet 'dataPortal'.
    Path to the archive file is specified by parameter 'j2ee.path.jar' -->
    <target name="j2ee.build.jar.dataPortal" description="Build Java EE archive for facet &apos;dataPortal&apos;">
        <jar destfile="${dataPortal.distro.dir}/tcga.war" duplicate="preserve">
            <manifest>
                <attribute name="Created-By" value="IntelliJ IDEA"/>
                <attribute name="Manifest-Version" value="1.0"/>
            </manifest>
            <zipfileset dir="${dataPortal.distro.dir}/war" prefix=""/>
        </jar>
    </target>

    <target name="clean.module.dataPortal" description="cleanup module">
        <delete dir="${dataPortal.distro.dir}"/>
    </target>

    <!-- This target will run everything and build everything from the start, this is run in AntHill -->
    <target name="module.dataPortal.prepareDeploy" depends="clean.module.dataPortal,j2ee.build.dataPortal,j2ee.build.jar.dataPortal"
            description="copies the whole deploy directory over to the destination server">

        <copy todir="${tcga.deploy}" overwrite="true">
            <fileset file="${dataPortal.distro.dir}/tcga.war"/>
        </copy>
    </target>

</project>